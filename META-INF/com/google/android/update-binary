#!/sbin/sh
# Magisk 模块安装脚本

# 设置环境
umask 022

# 输出信息函数
ui_print() { echo -e "ui_print $1\nui_print" > /proc/self/fd/$OUTFD; }

# 检查 Magisk 版本
require_new_magisk() {
  ui_print "*******************************"
  ui_print "  请安装 Magisk v20.4+! "
  ui_print "*******************************"
  exit 1
}

# 加载 Magisk 工具函数
OUTFD=$2
ZIPFILE=$3

mount /data 2>/dev/null

[ -f /data/adb/magisk/util_functions.sh ] || require_new_magisk
. /data/adb/magisk/util_functions.sh

[ $MAGISK_VER_CODE -lt 20400 ] && require_new_magisk

# 安装模块
install_module
exit 0